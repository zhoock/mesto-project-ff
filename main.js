(()=>{"use strict";var t="ccfd0c2b-b610-42b1-b6b5-ebb74bc474ac",e="wff-cohort-38",n=document.querySelector("#card-template"),r=document.querySelector(".places__list"),o=document.querySelector(".profile__image-edit-button"),a=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__image"),u=document.querySelector(".profile__title"),i=document.querySelector(".profile__description"),l=document.querySelector(".popup_type_img_edit"),s=document.forms["edit-avatar"],d=s.querySelector(".popup__input_type_avatar-url"),p=document.querySelector(".popup_type_edit"),f=document.forms["edit-profile"],_=f.querySelector(".popup__input_type_name"),m=f.querySelector(".popup__input_type_description"),y=document.querySelector(".profile__add-button"),v=document.querySelector(".popup_type_new-card"),h=document.forms["new-place"],b=h.querySelector(".popup__input_type_card-name"),S=h.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),g=document.querySelector(".popup__image"),q=document.querySelector(".popup__caption"),E=function(t,e,r,o,a,c,u,i,l){var s=n.content.cloneNode(!0).querySelector(".card"),d=s.querySelector(".card__image"),p=s.querySelector(".card__title"),f=s.querySelector(".card__delete-button"),_=s.querySelector(".card__like-button"),m=s.querySelector(".card__like-count");return d.src=t,d.alt=e,p.textContent=e,u===c?f.addEventListener("click",(function(){return r(s,i)})):f.remove(),d.addEventListener("click",o),_.addEventListener("click",(function(t){return a(t,i)})),m.textContent=l.length,l.some((function(t){return t._id===c}))?_.classList.add("card__like-button_is-active"):_.classList.remove("card__like-button_is-active"),s},k=function(n,r){fetch("https://nomoreparties.co/v1/".concat(e,"/cards/").concat(r),{method:"DELETE",headers:{authorization:t}}).then((function(t){if(!t.ok)throw new Error("Ошибка при удалении карточки: ".concat(t.status));return t.json()})).then((function(){n.remove()})).catch((function(t){console.error("Ошибка при удалении карточки:",t)}))},L=function(n,r){var o=n.target,a=o.classList.contains("card__like-button_is-active")?"DELETE":"PUT";fetch("https://nomoreparties.co/v1/".concat(e,"/cards/likes/").concat(r),{method:a,headers:{authorization:t}}).then((function(t){if(!t.ok)throw new Error("Ошибка при лайкинге карточки: ".concat(t.status));return t.json()})).then((function(t){o.classList.toggle("card__like-button_is-active");var e=t.likes.length,n=o.closest(".card").querySelector(".card__like-count");n&&(n.textContent=e)})).catch((function(t){console.error("Ошибка при обновлении лайка:",t)}))},x=function(t){A(t),t.classList.add("popup_is-opened")},w=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t._handleEscClose),t.removeEventListener("mousedown",t._handleOverlayClose)},A=function(t){var e=function(e){"Escape"===e.key&&w(t)},n=function(e){e.target===t&&w(t)};document.addEventListener("keydown",e),t.addEventListener("mousedown",n),t._handleEscClose=e,t._handleOverlayClose=n},j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},O=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""},T=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},U={baseUrl:"https://nomoreparties.co/v1/".concat(e),headers:{authorization:t,"Content-Type":"application/json"}},B=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function I(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,c,u=[],i=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=a.call(n)).done)&&(u.push(r.value),u.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return P(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var V,D=function(t){var e=t.target;g.onload=function(){x(C)},g.src=e.src,g.alt=e.alt,q.textContent=e.alt};s.addEventListener("submit",(function(t){t.preventDefault();var e,n=t.submitter,r=n.textContent;n.textContent="Сохранение...",(e=d.value,fetch("".concat(U.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:e})}).then(B)).then((function(t){c.style.backgroundImage='url("'.concat(t.avatar,'")'),w(l)})).catch((function(t){console.error("Ошибка при загрузке данных:",t)})).finally((function(){n.textContent=r}))})),f.addEventListener("submit",(function(t){t.preventDefault();var e,n,r,o=t.submitter,a=o.textContent;o.disabled=!0,o.textContent="Сохранение...",(e={name:_.value,about:m.value},n=e.name,r=e.about,fetch("".concat(U.baseUrl,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:n,about:r})}).then(B)).then((function(t){u.textContent=t.name,i.textContent=t.about,c.style.backgroundImage='url("'.concat(t.avatar,'")'),w(p)})).catch((function(t){console.error("Ошибка при загрузке данных:",t)})).finally((function(){o.disabled=!1,o.textContent=a}))})),h.addEventListener("submit",(function(t){t.preventDefault();var e=b.value,n=S.value,o=t.submitter,a=o.textContent;o.disabled=!0,o.textContent="Сохранение...",function(t){var e=t.name,n=t.link;return fetch("".concat(U.baseUrl,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:e,link:n})}).then(B)}({name:e,link:n}).then((function(t){var e=E(t.link,t.name,k,D,L,V,t.owner._id,t._id,t.likes);r.prepend(e),h.reset(),w(v)})).catch((function(t){console.error("Ошибка при добавлении карточки:",t)})).finally((function(){o.disabled=!1,o.textContent=a}))})),[{button:o,modal:l,getValues:function(){return[]}},{button:a,modal:p,getValues:function(){return[u.textContent,i.textContent]}},{button:y,modal:v,getValues:function(){return[]}}].forEach((function(t){var e=t.button,n=t.modal,r=t.getValues;e.addEventListener("click",(function(){var t=I(r(),2),e=t[0],o=t[1],a=n.querySelector(".popup__form");n.classList.contains("popup_type_img_edit")&&a.reset(),n.classList.contains("popup_type_edit")&&(_.value=e,m.value=o),n.classList.contains("popup_type_new-card")&&a.reset(),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){O(t,n,e)})),T(n,r,e)}(a,j),x(n)}))})),document.querySelectorAll(".popup__close").forEach((function(t){return t.addEventListener("click",(function(t){return w(t.target.closest(".popup"))}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);T(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?O(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),T(n,r,e)}))}))}(e,t)}))}(j),Promise.all([fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers}).then(B),fetch("".concat(U.baseUrl,"/cards"),{headers:U.headers}).then(B)]).then((function(t){var e=I(t,2),n=e[0],o=e[1];V=n._id,u.textContent=n.name,i.textContent=n.about,c.style.backgroundImage='url("'.concat(n.avatar,'")'),function(t,e,n){t.forEach((function(t){return e.appendChild(E(t.link,t.name,k,D,L,n,t.owner._id,t._id,t.likes))}))}(o,r,V)})).catch((function(t){console.error("Ошибка при загрузке данных:",t)}))})();